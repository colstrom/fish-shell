---
checkout:
  post:
    - git fetch --unshallow || true
    - git checkout 2.1.2
dependencies:
  post:
    - gem install fpm package_cloud
test:
  pre:
    - autoconf
    - ./configure
    - make
  override:
    - make test
  post:
    - checkinstall -y --pkgversion 2.x make install
    - dpkg -x fish_2.x-1_amd64.deb tmp
    - mv tmp/usr usr
    - fpm -s dir -t deb -n fish -v `git describe --tags` -d libncurses5 -d gettext usr
    - cp *.deb $CIRCLE_ARTIFACTS
deployment:
  package:
    branch: master
    commands:
      - package_cloud push colstrom/fish/ubuntu/precise `ls -1 *.deb`
